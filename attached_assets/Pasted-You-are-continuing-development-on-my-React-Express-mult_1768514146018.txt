You are continuing development on my React + Express multi-tenant app (single codebase).
REFINEMENT: Super Admin must be able to manage tenant user invitations + activation + password resets safely.

Current problem:
- In tenant onboarding, Super Admin can add/see tenant admins in a list, but cannot:
  - retrieve/copy their invite link
  - send/resend the email invite
  - view user-level invite status
Also requested:
- Super Admin needs ability to activate a tenant user and set an initial password
- Super Admin needs ability to reset a tenant user password

This prompt must be implemented in a safe, non-destructive way.

===============================================================================
ABSOLUTE NON-NEGOTIABLE SAFETY RULES
===============================================================================
- Do NOT change existing endpoint paths or response shapes (add-only endpoints are allowed).
- Do NOT weaken auth/tenancy/agreement enforcement.
- Do NOT expose passwords or secrets in logs or API responses.
- Do NOT store raw passwords anywhere; always hash server-side.
- Do NOT email passwords in plain text.
- Actions must be audited and confirmation-gated.
- Keep UI changes inside Super Admin Tenant Drawer + Tenant User Drawer only.

===============================================================================
GOALS
===============================================================================
1) Super Admin can click a tenant user row (especially tenant admin) to open a full-width drawer
   showing user details, role, status, invite status, and actions.
2) Super Admin can:
   - Generate and copy invite link (token URL) for that user
   - Send invite email (Mailgun if configured) and resend invite
   - See invite status (pending/accepted/expired) and regenerate token if expired
3) Super Admin can:
   - Activate user account (if pending/inactive) WITHOUT requiring invite acceptance
   - Trigger password reset flow (preferred) OR set an initial password safely (see Part E)
4) Tenant user can still complete onboarding normally (invite acceptance remains valid).

===============================================================================
PART A — SUPER ADMIN UI: TENANT USER MANAGEMENT INSIDE TENANT DRAWER
===============================================================================
A1) Where to access user management
- In Super Admin → Tenant Drawer → Onboarding Wizard tab (and optionally Team tab):
  - The list of tenant admins/users must have row actions:
    - “Manage User” (opens TenantUserDrawer)
    - “Copy Invite Link”
    - “Send/Resend Invite”

A2) TenantUserDrawer (full-width slide-out, no small modal)
Tabs inside the user drawer:
- Overview: name/email/role/status
- Invitation: invite link, status, expires, resend/regenerate
- Security: activate/deactivate, password reset tools (super-only)

A3) Always show current status badges
- User status: active/inactive/pending
- Invite status: pending/accepted/expired/none
- Last invite sent timestamp (if available)

===============================================================================
PART B — INVITE LINK VISIBILITY + EMAIL SEND/RESEND
===============================================================================
B1) Invitation model / data source
- Determine current invitation storage:
  - invitations table or equivalent (token, email, role, tenantId, expiresAt, usedAt)
- Ensure invites are tied to:
  - tenantId
  - target email (and/or userId)
  - role
- If the system currently stores invites only at creation time but doesn’t expose retrieval, add a retrieval endpoint.

B2) Required capabilities
From the user drawer:
1) View current invite link (copyable)
- If invite exists and not used/expired: show it
- If expired: show “Expired” and a “Regenerate” button

2) Send invite email
- If Mailgun configured: send invite email to the user
- If not configured: disable send button but still allow copy link

3) Resend invite
- Reuse same token if still valid OR generate a new token if expired (preferred)
- Update “lastSentAt” if you track it (additive only)

B3) Endpoints (add-only if missing)
- GET /api/v1/super/tenants/:tenantId/users/:userId/invite
  Returns safe fields:
  { inviteUrl, status, expiresAt, usedAt, lastSentAt? }
  MUST NOT return raw token separately; inviteUrl is sufficient.

- POST /api/v1/super/tenants/:tenantId/users/:userId/invite/send
  Sends email invite if configured; returns { ok: true }

- POST /api/v1/super/tenants/:tenantId/users/:userId/invite/regenerate
  Creates new token, returns { inviteUrl, expiresAt }

NOTE:
- Do NOT change existing invite acceptance endpoint behavior.

===============================================================================
PART C — ALLOW INVITING A USER AFTER THEY’VE BEEN ADDED
===============================================================================
If user already exists in tenant users list but never invited:
- “Send Invite” should generate an invite token on demand and send/copy it.

Rules:
- The system must support “create user first, invite later” flow.
- Invites must not depend on the user accepting in order for tenant onboarding to complete.

===============================================================================
PART D — SUPER ADMIN USER ACTIVATION (SAFE)
===============================================================================
Add super-only user activation controls:
- Activate / Deactivate user (toggle isActive)
- Confirm dialog required
- Audit event required:
  - super_user_activated_tenant_user
  - super_user_deactivated_tenant_user

Endpoint (add-only if missing):
- PATCH /api/v1/super/tenants/:tenantId/users/:userId
  Body can include { isActive: boolean, role?: ... } (role change optional)

===============================================================================
PART E — PASSWORD SET / RESET (SUPER ADMIN)
===============================================================================
Security guidance:
- Preferred: Super Admin triggers a PASSWORD RESET email (token-based), user sets their own password.
- If you ALSO want “Super Admin sets initial password”:
  - allow super admin to set a temporary password, but:
    - never email it
    - require “mustChangePasswordOnNextLogin=true”
    - display it ONCE in UI with copy warning (or better: generate reset link instead)

Implement both options if feasible, with strong safeguards:

E1) Password reset link (recommended)
- Super Admin clicks “Send Password Reset”
- System generates reset token (existing forgot-password mechanism if present)
- Sends reset email (Mailgun) OR displays copyable reset link
- Audit event: super_user_initiated_password_reset

Endpoints (add-only if missing):
- POST /api/v1/super/tenants/:tenantId/users/:userId/password-reset
  Returns { resetUrl, emailSent: boolean }

E2) Set initial password (optional, guarded)
- Super Admin enters password twice OR “Generate temporary password”
- Server hashes password and stores it
- Set mustChangePasswordOnNextLogin=true
- UI shows warning: “Do not send this password over email.”

Endpoint (add-only if missing):
- POST /api/v1/super/tenants/:tenantId/users/:userId/set-password
  Body: { password: string }
  Returns: { ok: true }
Never returns the password.

If mustChangePasswordOnNextLogin doesn’t exist:
- Additive column on users table is allowed ONLY if needed:
  - mustChangePasswordOnNextLogin boolean default false
Otherwise reuse existing.

E3) Tenant user experience
- If mustChangePasswordOnNextLogin==true:
  - force redirect to change-password page after login
  - do not allow access until changed

===============================================================================
PART F — TENANCY + AUTHORIZATION CONSTRAINTS
===============================================================================
- Only Super Admin (not impersonating OR impersonating is OK but still super) can use these endpoints.
- Endpoints must verify:
  - tenantId matches the user’s tenant membership
  - cannot modify users outside that tenant
- Do not leak whether a user exists in another tenant.

===============================================================================
PART G — UX DETAILS (REQUIRED)
===============================================================================
- Add “Manage User” drawer with clear actions
- Add “Copy Invite Link” and “Resend Invite” buttons
- Show:
  - status badges
  - last sent time
  - expiration
- Add toasts and consistent error handling:
  - show requestId from X-Request-Id on failure

===============================================================================
TESTS (MANDATORY MINIMUM)
===============================================================================
Backend:
1) super_can_get_invite_link_for_existing_user.test.ts
2) super_can_generate_invite_for_uninvited_user.test.ts
3) super_resend_invite_generates_new_when_expired.test.ts
4) super_password_reset_generates_token_and_scoped_to_tenant.test.ts
5) super_set_password_sets_must_change_flag.test.ts (if implemented)
6) tenant_admin_cannot_call_super_user_mgmt_endpoints.test.ts

Frontend:
7) user_drawer_shows_invite_link_and_resend.test.tsx
8) show_request_id_on_failure.test.tsx

===============================================================================
DOCUMENTATION (REQUIRED)
===============================================================================
- Update /docs/SUPER_ADMIN_GUIDE.md:
  - Tenant user management via drawer
  - Invite lifecycle (create -> send -> accept)
  - Reset password flow
- Update /docs/AUTHENTICATION.md:
  - reset tokens, must-change-password behavior
- Update /docs/EMAIL_OBSERVABILITY.md if outbox logging exists:
  - invite + reset email entries

===============================================================================
ACCEPTANCE CRITERIA
===============================================================================
- Super Admin can open a tenant user drawer from onboarding list.
- Super Admin can view/copy invite link for that user and send/resend invite email.
- Super Admin can activate/deactivate the user.
- Super Admin can trigger password reset (and optionally set an initial password with must-change flag).
- Tenant user can sign in normally and complete onboarding.
- No breaking changes to existing endpoints/flows; tests pass.

===============================================================================
OUTPUT REQUIRED
===============================================================================
- Endpoints used/added
- Where invite link is stored and how it’s retrieved
- How password reset/set is implemented safely
- Manual test checklist (local + Railway)
